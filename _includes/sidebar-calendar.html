{% if page.calendar %}
  <link rel="stylesheet" href="/assets/css/components/calendar.css"/>
  <!-- æ—¥å†æ¨¡å— -->
  <h3>æ—¥å†ğŸ“…</h3>
  <center id="calendar_container">
    <table>
      <thead id="calendar_header">
        <td>
          <table>
            <td id="pre_month">&lt;</td>
            <td id="show_date"></td>
            <td id="next_month">&gt;</td>
          </table>
        </td>
      </thead>
      <tr id="calendar_weeks">
        <td>
          <table>
            <td class="calendar_column">Sun</td>
            <td class="calendar_column">Mon</td>
            <td class="calendar_column">Tue</td>
            <td class="calendar_column">Wed</td>
            <td class="calendar_column">Thu</td>
            <td class="calendar_column">Fri</td>
            <td class="calendar_column">Sat</td>
          </table>
        </td>
      </tr>
      <tr id="calendar_body">
        <td id="calendar_body_container"></td>
      </tr>
    </table>
  </center>
  <script>
    var today = new Date();

    var articles = new Map();
    {% for article in site.posts %}
      {% assign date = article.date | date: '%Y%m%d' %}
        articles.set('{{ date }}', '{{ article.url }}');
    {% endfor %}
    {% for article in site.wiki %}
      {% assign date = article.date | date: '%Y%m%d' %}
        articles.set('{{ date }}', '{{ article.url }}');
    {% endfor %}

    /**
     * æ ¹æ®ä¼ å…¥çš„æ—¥æœŸç”Ÿæˆå½“æœˆæœˆå†
     * 
     * @param date: æŸæœˆæŸæ—¥æ—¥æœŸ
     */
    function generateCalendar(date) {
      var theYear  = date.getFullYear();                          // å½“å¹´
      var theMonth = date.getMonth() + 1;                         // å½“æœˆ
      var theDay   = date.getDate();                              // å½“å¤©
      var dayBegin = new Date(theYear, theMonth - 1, 1).getDay(); // å½“æœˆç¬¬ä¸€å¤©åœ¨ä¸€å‘¨çš„ç¬¬å‡ å¤©ï¼ˆå‘¨æ—¥å¼€å§‹ï¼‰
      var dayCount = new Date(theYear, theMonth, 0).getDate();    // å½“æœˆå¤©æ•°
      if (theMonth != today.getMonth() + 1) theDay = 38;          // å¦‚æœä¸æ˜¯æœ¬æœˆï¼Œåˆ™ä¸å¯èƒ½åˆšå¥½æœ‰ä»Šå¤©
      else theDay = today.getDate();

      if (theMonth < 10) theMonth = "0" + "" + theMonth;
      document.getElementById('show_date').innerHTML = theYear + '.' + theMonth; // å¹´æœˆæ˜¾ç¤º

      var html = '<table><tr>';
      var dayIndex  = 1; // æœˆä¸­çš„æ¯ä¸€å¤©
      for (var i = 0; i < 37; i++) { // æœ‰çš„æœˆä»½æœ€åå‡ å¤©ä¼šå¤šå‡ºä¸€è¡Œï¼Œæœ€è¿œæ˜¯åˆ°ç¬¬ 37 ä¸ªæ ¼å­ï¼Œå› æ­¤ç›´æ¥æ‰€æœ‰éƒ½å¡«æ»¡ 37 ä¸ªæ ¼å­
        if (i <= dayBegin) html += '<td class="calendar_column"></td>'; 
        else if (i > dayBegin + dayCount) html += '<td class="calendar_column" style="opacity: 0">a</td>'; 
        else {
          if (dayIndex < 10) dayIndex = "0" + dayIndex;
          var post = articles.get('' + theYear + theMonth + dayIndex);
          if (post != null) { // æœ‰å‘å¸ƒï¼Œæ¿€æ´»ä¸ºç»¿è‰²
            html += '<td class="calendar_column" ><a href="{{ site.url }}' + post + '" style="color:#5a862d;font-weight:bolder"  title="' + post + '"';
          } else {
            html += '<td class="calendar_column" onclick="onDateClick('+ theYear + theMonth + dayIndex + ')" title="è¿™ä¸€å¤©å·æ‡’å–½"><a ';
          }
          if (dayIndex == theDay) { // å¦‚æœæ˜¯ä»Šå¤©ï¼Œæ¿€æ´»ä¸ºè“è‰²
            html += 'class="active_date">' + dayIndex + '</a>';
          } else {
            html += 'class="normal_date">' + dayIndex + '</a>';
          }
          dayIndex++;
        }
        if (i % 7 == 0) html += '</tr><tr>';
      }
      html += '</tr></table>';
      document.getElementById("calendar_body_container").innerHTML = html;
    }

    window.onload = function() {
      generateCalendar(today);
    }

    function onDateClick(date) {
      alert(date + "å·æ‡’äº†ä¸€æ•´å¤©ï¼Œä»€ä¹ˆéƒ½æ²¡å†™");
    }

    // ä¸Šä¸€ä¸ªæœˆ
    document.getElementById('pre_month').onclick = function() {
      var targetMonth = parseInt(document.getElementById('show_date').innerHTML.substr(5)) - 1;
      var theYear = parseInt(document.getElementById('show_date').innerHTML.substr(0, 4));
      if (targetMonth == (today.getMonth() + 1) && theYear == today.getFullYear()) {
        generateCalendar(today);
      } else{
        generateCalendar(new Date(theYear, targetMonth - 1, 1));
      }
    }

    // ä¸‹ä¸€ä¸ªæœˆ
    document.getElementById('next_month').onclick = function() {
      var targetMonth = parseInt(document.getElementById('show_date').innerHTML.substr(5)) + 1;
      var theYear = parseInt(document.getElementById('show_date').innerHTML.substr(0, 4));
      if (targetMonth == (today.getMonth() + 1) && theYear == today.getFullYear()) {
        generateCalendar(today);
      } else{
        generateCalendar(new Date(theYear, targetMonth - 1, 1));
      }
    }
  </script>
{% endif %}